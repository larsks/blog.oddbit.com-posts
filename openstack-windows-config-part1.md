Title: Automatic configuration of Windows instances in OpenStack, part 1
Slug: openstack-windows-1

This is the first of two articles in which I will discuss my work in
getting some Windows instances up and running in our [OpenStack][]
environment.  This article is primarily about problems I encountered
along the way, while the [second article][] will focus on the mechanism I
eventually put in place.

[second article]: openstack-windows-2

## Motivations

Like many organizations, we have a mix of Linux and Windows in our
environment.  Some folks in my group felt that it would be nice to let
our Windows admins take advantage of OpenStack for prototyping and
sandboxing in the same ways our Linux admins can use it.

While it is trivial to get Linux instances running in
OpenStack (there are downloadable images from several distributions that
will magically configure themselves on first boot), getting Windows
systems set up is a little trickier.  There are no pre-configured
images to download, and it looks as if there aren't that many people
trying to run Windows under OpenStack right now so there is a lot less
common experience to reference.

## Like the cool kids do it

My first approach to this situation was to set up our Windows
instances to act just like our Linux instances:

- Install [Cygwin][].
- Run an SSH server.
- Have the system pull down an SSH public key on first boot and use
  this for administrative access.

This worked reasonably well, but many people felt that this wasn't a
great solution because it wouldn't feel natural to a typical Windows
administrator.  It also required a full Cygwin install to drive
things, which isn't terrible but still feels like a pretty big hammer.

As an alternative, we decided we needed some way to either (a) allow
the user to pass a password into the instance environment, or (b)
provide some way for the instance to communicate a generated password
back to the user.

## How about user-data?

One of my colleagues suggested that we could allow people to pass an
administrative password into the environment via the `user-data`
attribute available from the [metadata service][].  While this sounds
like a reasonable idea at first, it has one major flaw: data from the
metadata service is available to anyone on the system who is able to
retrieve a URL.  This would make it trivial for anyone on the instance
to retrieve the administrator password.

## How about adminPass?

When you boot an instance using the nova command line tools...

    nova boot ...

You get back a chunk of metadata, including an `adminPass` key, which
is a password randomly generated by OpenStack and availble during the
instance provisioning process:

    +------------------------+--------------------------------------+
    |        Property        |                Value                 |
    +------------------------+--------------------------------------+
    ...
    | adminPass              | RBiWrSNYqK5R                         |
    ...
    +------------------------+--------------------------------------+

This would be an ideal solution, if only I were able to figure out how
OpenStack made this value available to the instance.

[metadata service]: http://docs.openstack.org/trunk/openstack-compute/admin/content/metadata-service.html

[cygwin]: http://cygwin.com/
[openstack]: http://www.openstack.org/

